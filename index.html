<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>ROSARY RIDGEBED¬©¬Æ ‚Ä¢ 7 Gaben H√ºgelbeet Pyramide</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/exporters/STLExporter.js"></script>
<style>
  body{margin:0;overflow:hidden;background:#0a1a2f;color:#fff;font-family:Arial}
  #info,#controls{position:absolute;padding:15px;border-radius:12px;backdrop-filter:blur(10px);border:1px solid rgba(212,175,55,0.4);background:rgba(0,0,0,0.7);z-index:10}
  #info{top:10px;left:10px;max-width:420px}
  #controls{bottom:20px;left:20px}
  button{padding:10px 18px;margin:5px;background:linear-gradient(45deg,#d4af37,#ffd700);border:none;border-radius:8px;cursor:pointer;font-weight:bold;color:#000}
  #modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:100;justify-content:center;align-items:center}
  #modal-content{background:#111;padding:30px;border-radius:15px;border:3px solid #d4af37;max-width:600px;text-align:center}
  .close{float:right;font-size:32px;cursor:pointer;color:#d4af37}
</style>
</head>
<body>
<div id="canvas-container"></div>

<div id="info">
  <h1 style="margin:0;color:#d4af37">7 Gaben des Hl. Geistes ‚Äì Goldener Weg</h1>
  <button onclick="toggleView()">Laien ‚Üî Forscher</button>
  <div id="laien"><p><b>Eselsbr√ºcke:</b> Der H√ºgel w√§chst wie eine Schnecke üêå ‚Äì jede Schicht eine Gabe.</p></div>
  <div id="forscher" style="display:none"><p><b>Rosenkranz n=17 ‚Üí 153</b><br>h ‚âà Œ£ binom(17,k)(1/œÜ)^k ¬∑ h^(k)(Q)</p></div>
</div>

<div id="controls">
  <button onclick="resetView()">Ansicht zur√ºck</button>
  <button onclick="toggleRotation()">Rotation</button>
  <button onclick="exportSTL()">3D-Druck STL</button>
</div>

<div id="modal" onclick="this.style.display='none'">
  <div id="modal-content" onclick="event.stopPropagation()">
    <span class="close">√ó</span>
    <h2 id="modal-title" style="color:#d4af37"></h2>
    <p id="modal-psalm"></p>
    <p id="modal-denk" style="color:#d4af37;font-style:italic;"></p>
  </div>
</div>

<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0a1a2f);
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(10,10,15);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.getElementById('canvas-container').appendChild(renderer.domElement);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

let isRotating = true;
const terraces = [];

// Gras-Textur
const loader = new THREE.TextureLoader();
const grass = loader.load('https://i.imgur.com/4tZEm8T.jpeg');
grass.wrapS = grass.wrapT = THREE.RepeatWrapping;
grass.repeat.set(10,10);

// 7 H√ºgelbeet-Schichten
const colors = [0x8b4513,0x8b5a2b,0x228b22,0x654321,0x4b3621,0x5d4037,0x228b22];
const gaben = ["Furcht des Herrn","Fr√∂mmigkeit","Erkenntnis","St√§rke","Rat","Verstand","Weisheit"];
for(let i=0;i<7;i++){
  const h = (i+1)/8*16;
  const r = 9*(1-i/8);
  const geo = new THREE.CylinderGeometry(r, r+1.2, 2.4, 64,1,true);
  const mat = new THREE.MeshPhongMaterial({
    color: colors[i],
    map: i===6 ? grass : null,
    bumpMap: grass,
    bumpScale: 0.6
  });
  const mesh = new THREE.Mesh(geo, mat);
  mesh.position.y = -8 + h;
  scene.add(mesh);
  terraces.push(mesh);
}

// Goldene Spirale (Chartres-√§hnlich)
const points = [];
let radius = 0.3, angle = 0, y = -8;
for(let i=0;i<1200;i++){
  points.push(new THREE.Vector3(radius*Math.cos(angle), y, radius*Math.sin(angle)));
  angle += 0.15;
  radius += 0.008;
  if(i%80===0) y += 0.8;
}
const curve = new THREE.CatmullRomCurve3(points);
const tube = new THREE.TubeGeometry(curve,1200,0.2,16,false);
const tubeMat = new THREE.MeshPhongMaterial({color:0xd4af37,emissive:0x885500});
const spiral = new THREE.Mesh(tube, tubeMat);
scene.add(spiral);

// Salomonisches Siegel + Pyramide oben
const starShape = new THREE.Shape();
... (kompletter Stern-Code aus vorheriger Antwort)
const pyramid = new THREE.Mesh(new THREE.ConeGeometry(1.8,4,6), new THREE.MeshPhongMaterial({color:0xd4af37}));
pyramid.position.y = 10;
scene.add(pyramid);
scene.add(star);

// Licht...

// Licht
const light = new THREE.HemisphereLight(0xffffff,0x444444,1.8);
scene.add(light);
const dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(5,10,7);
scene.add(dirLight);

// Raycaster + Modal-Daten
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
const psalmData = [ /* 7 Eintr√§ge wie in vorheriger Antwort */ ];

window.addEventListener('click', (e) => {
  mouse.x = (e.clientX/innerWidth)*2-1;
  mouse.y = -(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hits = raycaster.intersectObjects(terraces);
  if(hits.length>0){
    const idx = terraces.indexOf(hits[0].object);
    document.getElementById('modal-title').textContent = gaben[idx];
    document.getElementById('modal-ps').textContent = psalmData[idx].psalm + ": " + psalmData[idx].text;
    document.getElementById('modal-denk').textContent = "Denkgesetz: " + psalmData[idx].denk;
    document.getElementById('modal').style.display = 'flex';
  }
});

// STL Export
function exportSTL(){
  const exporter = new THREE.STLExporter();
  const result = exporter.parse(scene);
  const blob = new Blob([result],{type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'rosary_ridgebed.stl';
  a.click();
}

function animate(){
  requestAnimationFrame(animate);
  if(isRotating) spiral.rotation.y += 0.002;
  controls.update();
  renderer.render(scene,camera);
}
animate();

window.onresize = () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
