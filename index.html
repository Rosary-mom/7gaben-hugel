<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>ROSARY RIDGEBED¬©¬Æ‚Ñ¢ ‚Ä¢ 7 Gaben H√ºgelbeet Pyramide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/exporters/STLExporter.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #001133; color: #fff; font-family: Arial, sans-serif; }
    #info, #controls { position: absolute; padding: 20px; border-radius: 12px; backdrop-filter: blur(12px); border: 1px solid rgba(212, 175, 55, 0.5); background: rgba(0, 0, 0, 0.7); z-index: 10; }
    #info { top: 10px; left: 10px; max-width: 420px; }
    #controls { bottom: 20px; left: 20px; }
    button { padding: 10px 20px; margin: 5px; background: linear-gradient(45deg, #d4af37, #ffd700); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: #000; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); }
    #modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 100; justify-content: center; align-items: center; }
    #modal-content { background: #111; padding: 35px; border-radius: 15px; border: 3px solid #d4af37; max-width: 650px; text-align: center; }
    .close { float: right; font-size: 32px; cursor: pointer; color: #d4af37; }
  </style>
</head>
<body>
<div id="canvas-container"></div>

<div id="info">
  <h1 style="margin:0;color:#d4af37;text-shadow:0 0 15px gold">7 Gaben des Hl. Geistes ‚Äì Goldener Weg</h1>
  <button onclick="toggleView()">Laien ‚Üî Forscher Modus</button>
  <div id="laien"><p style="line-height:1.6"><b>Eselsbr√ºcke:</b> Der H√ºgel w√§chst wie eine Schnecke üêå ‚Äì jede Windung gr√∂√üer (Fibonacci). Jede Schicht ist eine Gabe ‚Äì von der Demut unten bis zur Weisheit oben.</p></div>
  <div id="forscher" style="display:none"><p style="line-height:1.6"><b>Rosenkranz-Approximation n=17 ‚Üí 153</b><br>h ‚âà Œ£ binom(17,k) (1/œÜ)^k ¬∑ h^(k)(Q)<br>Skaleninvarianz: S(r) = k ¬∑ r^œÜ</p></div>
</div>

<div id="controls">
  <button onclick="camera.position.set(10,10,15);controls.reset()">Ansicht zur√ºck</button>
  <button onclick="isRotating=!isRotating">Rotation an/aus</button>
  <button onclick="exportSTL()">3D-Druck STL</button>
</div>

<div id="modal" onclick="this.style.display='none'">
  <div id="modal-content" onclick="event.stopPropagation()">
    <span class="close">√ó</span>
    <h2 id="modal-title" style="color:#d4af37"></h2>
    <p id="modal-psalm"></p>
    <p id="modal-denk" style="color:#d4af37;font-style:italic;"></p>
  </div>
</div>

<script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x001133);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(10,10,15);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.getElementById('canvas-container').appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

let isRotating = true;
const terraces = [];

// Gras-Textur
const loader = new THREE.TextureLoader();
let grass;
loader.load('https://i.imgur.com/4tZEm8T.jpeg', texture => {
  grass = texture;
  grass.wrapS = grass.wrapT = THREE.RepeatWrapping;
  grass.repeat.set(12,12);
  renderer.render(scene, camera);
});

// 7 Schichten H√ºgelbeet
const colors = [0x8b4513,0x8b5a2b,0x228b22,0x654321,0x4b3621,0x5d4037,0x228b22];
const gaben = ["Furcht des Herrn","Fr√∂mmigkeit","Erkenntnis","St√§rke","Rat","Verstand","Weisheit"];
for(let i=0;i<7;i++){
  const h = (i+1)/8*16;
  const r = 9*(1-i/8);
  const geo = new THREE.CylinderGeometry(r, r+1.2, 2.5, 64,1,true);
  const mat = new THREE.MeshPhongMaterial({
    color: colors[i],
    map: i===6 && grass ? grass : null,
    bumpMap: grass || null,
    bumpScale: 0.7,
    shininess: 40
  });
  const mesh = new THREE.Mesh(geo, mat);
  mesh.position.y = -8 + h;
  scene.add(mesh);
  terraces.push(mesh);
}

// Goldene Spirale ‚Äì jetzt ohne Fehler
const points = [];
let radius = 0.3, angle = 0, y = -8;
for(let i=0;i<1400;i++){
  points.push(new THREE.Vector3(radius*Math.cos(angle), y, radius*Math.sin(angle)));
  angle += 0.13;
  radius += 0.009;
  if(i%100===0) y += 0.9; // <-- jetzt korrekt!
}
const curve = new THREE.CatmullRomCurve3(points);
const tubeGeo = new THREE.TubeGeometry(curve,1400,0.25,16,false);
const tubeMat = new THREE.MeshPhongMaterial({color:0xffd700,emissive:0xaa8800,shininess:150});
const spiral = new THREE.Mesh(tubeGeo, tubeMat);
scene.add(spiral);

// Salomonisches Siegel + Pyramide oben
const starShape = new THREE.Shape();
const outer = 1.5, inner = 0.75;
for(let i=0;i<12;i++){ // <-- 12 f√ºr richtigen Stern
  const a = i/6*Math.PI;
  const r = i%2===0 ? outer : inner;
  i===0 ? starShape.moveTo(r*Math.sin(a),r*Math.cos(a)) : starShape.lineTo(r*Math.sin(a),r*Math.cos(a));
}
starShape.closePath();
const starGeo = new THREE.ExtrudeGeometry(starShape,{depth:0.4,bevelEnabled:true});
const starMat = new THREE.MeshPhongMaterial({color:0xffd700,emissive:0xaa8800});
const star = new THREE.Mesh(starGeo, starMat);
star.rotation.x = -Math.PI/2;
star.position.set(0,10.6,0);
scene.add(star);

const pyramid = new THREE.Mesh(new THREE.ConeGeometry(1.9,4.2,6), starMat);
pyramid.position.y = 9.9;
scene.add(pyramid);

// LICHT ‚Äì hell und golden
scene.add(new THREE.AmbientLight(0xffffff, 4));
const sun = new THREE.DirectionalLight(0xfff8e1, 10);
sun.position.set(15,35,15);
scene.add(sun);
scene.add(new THREE.PointLight(0xffd700, 8, 100));
scene.add(new THREE.HemisphereLight(0x87ceeb, 0x228b22, 5));

// Modal-Daten
const data = [
  {psalm:"Psalm 120", text:"In meiner Not rief ich zum Herrn ‚Ä¶", denk:"Kingfisher-Gesetz"},
  {psalm:"Psalm 122", text:"Freut euch mit mir ‚Ä¶", denk:"DiaKonos-Gesetz"},
  {psalm:"Psalm 124", text:"W√§re der Herr nicht bei uns ‚Ä¶", denk:"Skaleninvarianz"},
  {psalm:"Psalm 126", text:"Die mit Tr√§nen s√§en ‚Ä¶", denk:"Hebel-Gesetz"},
  {psalm:"Psalm 128", text:"Wohl dem, der den Herrn f√ºrchtet ‚Ä¶", denk:"Rosenkranz-Iteration"},
  {psalm:"Psalm 130", text:"Aus den Tiefen rufe ich ‚Ä¶", denk:"Coan-Paradoxon"},
  {psalm:"Psalm 134", text:"Segnet den Herrn ‚Ä¶", denk:"Heureka ‚Äì Vollendung"}
];

// Raycaster ‚Äì jetzt korrekt
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
window.addEventListener('click', e => { // <-- korrekt!
  mouse.x = (e.clientX/window.innerWidth)*2-1;
  mouse.y = -(e.clientY/window.innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hits = raycaster.intersectObjects(terraces);
  if(hits.length){
    const i = terraces.indexOf(hits[0].object);
    document.getElementById('modal-title').textContent = gaben[i];
    document.getElementById('modal-psalm').textContent = data[i].psalm + ": " + data[i].text;
    document.getElementById('modal-denk').textContent = "Denkgesetz: " + data[i].denk;
    document.getElementById('modal').style.display = 'flex';
  }
});

// Export + toggle + animate
function exportSTL(){
  const exporter = new THREE.STLExporter();
  const stl = exporter.parse(scene);
  const blob = new Blob([stl],{type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'rosary_ridgebed.stl';
  a.click();
}

function toggleView(){
  const l = document.getElementById('laien');
  const f = document.getElementById('forscher');
  l.style.display = l.style.display==='none' ? 'block' : 'none';
  f.style.display = f.style.display==='none' ? 'block' : 'none';
}

function animate(){
  requestAnimationFrame(animate);
  if(isRotating) spiral.rotation.y += 0.002;
  controls.update();
  renderer.render(scene, camera);
}
animate();

window.onresize = () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
};
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>ROSARY RIDGEBED¬©¬Æ‚Ñ¢ ‚Ä¢ Goldener Weg (Level2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/exporters/STLExporter.js"></script>
  
  <style>
    body{
      margin:0;
      overflow:hidden;
      /* Hintergrund mit sanftem Verlauf */
      background: radial-gradient(circle at center, #0b1a33 0%, #000000 100%);
      color:#fff;
      font-family: Arial, sans-serif;
    }
    
    #info, #controls {
      position:absolute;
      padding:20px;
      border-radius:12px;
      backdrop-filter:blur(12px);
      border:1px solid rgba(212,175,55,0.5);
      background:rgba(0,0,0,0.7);
      z-index:10;
      box-shadow: 0 0 20px rgba(212,175,55,0.2);
    }
    #info{top:10px;left:10px;max-width:420px}
    #controls{bottom:20px;left:20px}
    
    button{
      padding:10px 20px;
      margin:5px;
      /* Goldener Button-Verlauf */
      background:linear-gradient(45deg,#d4af37,#ffd700);
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
      color:#000;
      box-shadow:0 4px 10px rgba(0,0,0,0.5);
      transition: transform 0.2s;
    }
    button:hover{transform: scale(1.05);}
    
    #modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:100;justify-content:center;align-items:center;backdrop-filter: blur(5px);}
    #modal-content{background:#1a1a1a;padding:35px;border-radius:15px;border:2px solid #d4af37;max-width:600px;text-align:center; position: relative;}
    .close{position: absolute; top: 10px; right: 20px; font-size:32px;cursor:pointer;color:#d4af37;}
  </style>
</head>
<body>
<div id="canvas-container"></div>

<div id="info">
  <h1 style="margin:0;color:#d4af37;text-shadow:0 0 10px rgba(212,175,55,0.5)">7 Gaben des Hl. Geistes ‚Äì Goldener Weg</h1>
  <button onclick="toggleView()">Modus: Laien ‚Üî Forscher</button>
  <div id="laien"><p style="line-height:1.6"><b>Das Prinzip:</b> Der H√ºgel w√§chst spiralf√∂rmig wie ein Schneckenhaus üêå (Fibonacci). Jede Ebene steht f√ºr eine Gabe ‚Äì von der Basis bis zur Spitze.</p></div>
  <div id="forscher" style="display:none"><p style="line-height:1.6"><b>Rosenkranz-Approximation</b><br>h ‚âà Œ£ binom(17,k) (1/œÜ)^k ¬∑ h^(k)(Q)<br>Skaleninvarianz: S(r) = k ¬∑ r^œÜ</p></div>
</div>

<div id="controls">
  <button onclick="resetCamera()">Ansicht zur√ºck</button>
  <button onclick="toggleRotation()">Rotation an/aus</button>
  <button onclick="exportSTL()">3D-Druck STL</button>
</div>

<div id="modal" onclick="closeModal()">
  <div id="modal-content" onclick="event.stopPropagation()">
    <span class="close" onclick="closeModal()">√ó</span>
    <h2 id="modal-title" style="color:#ffd700"></h2>
    <hr style="border-color: #333; margin: 15px 0;">
    <p id="modal-psalm"></p>
    <p id="modal-denk" style="color:#d4af37;font-style:italic; margin-top: 20px;"></p>
  </div>
</div>

<script>
// --- SETUP ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x001133);
scene.fog = new THREE.FogExp2(0x001133, 0.015); // Nebel f√ºr Tiefe

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(10, 12, 18); // Etwas h√∂herer Startpunkt

const renderer = new THREE.WebGLRenderer({antialias:true, alpha: true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true; // WICHTIG: Schatten aktivieren
renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Weiche Schatten
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
document.getElementById('canvas-container').appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.autoRotate = true; // Startet mit Rotation
controls.autoRotateSpeed = 0.5;

let isRotating = true; // Wird prim√§r durch controls.autoRotate gesteuert
const terraces = [];

// --- PROZEDURALE TEXTUR (Keine externen Links) ---
function createGrassTexture() {
  const canvas = document.createElement('canvas');
  canvas.width = 512; canvas.height = 512;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#2a5a1b';
  ctx.fillRect(0,0,512,512);
  for(let i=0; i<5000; i++) {
    ctx.fillStyle = Math.random() > 0.5 ? '#3a7a2b' : '#1a3a0b';
    ctx.fillRect(Math.random()*512, Math.random()*512, Math.random()*3 + 1, Math.random()*5 + 1);
  }
  const texture = new THREE.CanvasTexture(canvas);
  texture.wrapS = THREE.RepeatWrapping;
  texture.wrapT = THREE.RepeatWrapping;
  texture.repeat.set(8, 8); // Repetition erh√∂hen
  return texture;
}
const grassTexture = createGrassTexture();

// --- BELEUCHTUNG ---
const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambientLight);

const sunLight = new THREE.DirectionalLight(0xfffaed, 3.5);
sunLight.position.set(20, 50, 20);
sunLight.castShadow = true;
sunLight.shadow.mapSize.width = 2048;
sunLight.shadow.mapSize.height = 2048;
scene.add(sunLight);

const goldLight = new THREE.PointLight(0xffd700, 5, 30);
goldLight.position.set(0, 10, 0);
scene.add(goldLight);


// 7 Schichten H√ºgelbeet
const colors = [0x5c4033, 0x70503c, 0x5d4037, 0x4a3728, 0x3e2b1f, 0x2b1e16, 0x228b22];
const gaben = ["Furcht des Herrn","Fr√∂mmigkeit","Erkenntnis","St√§rke","Rat","Verstand","Weisheit"];

for(let i=0; i<7; i++){
  const height = 2.5;
  const bottomRadius = 9 * (1 - i/8) + 1.2;
  const topRadius = 9 * (1 - (i+1)/8) + 1.2;
  
  const geo = new THREE.CylinderGeometry(topRadius, bottomRadius, height, 64);
  
  let mat;
  if (i === 6) {
     // Oberste Schicht mit garantierter Textur
     mat = new THREE.MeshStandardMaterial({ 
       map: grassTexture,
       bumpMap: grassTexture,
       bumpScale: 0.5,
       color: colors[i],
       roughness: 0.8
     });
  } else {
     // Erd-Schichten (StandardMaterial reagiert auf Schatten)
     mat = new THREE.MeshStandardMaterial({ 
       color: colors[i], 
       roughness: 0.9, 
       metalness: 0.1
     });
  }
  
  const mesh = new THREE.Mesh(geo, mat);
  mesh.position.y = -8 + (i * height);
  mesh.castShadow = true;
  mesh.receiveShadow = true;
  mesh.userData = { id: i }; // ID speichern f√ºr Raycaster
  scene.add(mesh);
  terraces.push(mesh);
}

// Goldene Spirale
const points = [];
let radius = 0.3, angle = 0, y = -8;
for(let i=0;i<1400;i++){
  points.push(new THREE.Vector3(radius*Math.cos(angle), y, radius*Math.sin(angle)));
  angle += 0.13;
  radius += 0.009;
  if(i%100===0) y += 0.9;
}
const curve = new THREE.CatmullRomCurve3(points);
const tubeGeo = new THREE.TubeGeometry(curve,1400,0.25,16,false);
const tubeMat = new THREE.MeshPhysicalMaterial({
    color: 0xffd700, 
    emissive: 0xaa8800, 
    emissiveIntensity: 0.7,
    metalness: 1.0, 
    roughness: 0.1 
});
const spiral = new THREE.Mesh(tubeGeo, tubeMat);
spiral.castShadow = true;
scene.add(spiral);

// Salomonisches Siegel (Spitze)
const outer = 1.5, inner = 0.75;
const starShape = new THREE.Shape();
for(let i=0; i<12; i++){
  const a = i/6*Math.PI;
  const r = i%2===0 ? outer : inner;
  if(i===0) starShape.moveTo(r*Math.sin(a),r*Math.cos(a));
  else starShape.lineTo(r*Math.sin(a),r*Math.cos(a));
}
starShape.closePath();
const starGeo = new THREE.ExtrudeGeometry(starShape,{depth:0.4,bevelEnabled:true});
const goldMat = new THREE.MeshPhysicalMaterial({
    color: 0xffd700, 
    metalness: 1.0, 
    roughness: 0.05, 
    clearcoat: 1.0
});
const star = new THREE.Mesh(starGeo, goldMat);
star.rotation.x = -Math.PI/2;
star.position.set(0, 10.6, 0); // Position angepasst
star.castShadow = true;
scene.add(star);

// --- MODAL DATEN ---
const data = [
  {psalm:"Psalm 111", text:"Die Furcht des Herrn ist der Weisheit Anfang.", denk:"Fundament-Gesetz"},
  {psalm:"Psalm 120", text:"In meiner Not rief ich zum Herrn ‚Ä¶", denk:"Kingfisher-Gesetz"},
  {psalm:"Psalm 122", text:"Ich freute mich √ºber die, so mir sagten‚Ä¶", denk:"DiaKonos-Gesetz"},
  {psalm:"Psalm 124", text:"W√§re der Herr nicht bei uns ‚Ä¶", denk:"Skaleninvarianz"},
  {psalm:"Psalm 126", text:"Die mit Tr√§nen s√§en, werden mit Freuden ernten.", denk:"Hebel-Gesetz"},
  {psalm:"Psalm 130", text:"Aus den Tiefen rufe ich ‚Ä¶", denk:"Coan-Paradoxon"},
  {psalm:"Psalm 134", text:"Segnet den Herrn ‚Ä¶", denk:"Heureka ‚Äì Vollendung"}
];

// Raycaster & Interaction
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener('pointerdown', e => { 
  mouse.x = (e.clientX/window.innerWidth)*2-1;
  mouse.y = -(e.clientY/window.innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hits = raycaster.intersectObjects(terraces);
  if(hits.length){
    const i = hits[0].object.userData.id; // Nutze die gespeicherte ID
    document.getElementById('modal-title').textContent = gaben[i];
    document.getElementById('modal-psalm').textContent = data[i].psalm + ": " + data[i].text;
    document.getElementById('modal-denk').textContent = "Denkgesetz: " + data[i].denk;
    document.getElementById('modal').style.display = 'flex';
    controls.autoRotate = false;
  }
});

function closeModal() {
    document.getElementById('modal').style.display = 'none';
    controls.autoRotate = true;
}

// Export + toggle + animate
function exportSTL(){
  const exporter = new THREE.STLExporter();
  const stl = exporter.parse(scene);
  const blob = new Blob([stl],{type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'rosary_ridgebed.stl';
  a.click();
}

function resetCamera(){
  camera.position.set(10, 12, 18);
  controls.reset();
}

function toggleRotation(){
  controls.autoRotate = !controls.autoRotate;
  isRotating = controls.autoRotate;
}

function toggleView(){
  const l = document.getElementById('laien');
  const f = document.getElementById('forscher');
  if (l.style.display === 'none') {
    l.style.display = 'block';
    f.style.display = 'none';
  } else {
    l.style.display = 'none';
    f.style.display = 'block';
  }
}

function animate(){
  requestAnimationFrame(animate);
  
  // Leichte Animation der Spitze
  star.rotation.y += 0.005;
  
  controls.update();
  renderer.render(scene, camera);
}
animate();

window.onresize = () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
};
</script>
</body>
</html>
