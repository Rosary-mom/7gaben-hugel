<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>ROSARY RIDGEBEDÂ©Â®â„¢ â€¢ High-End Simulation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/exporters/STLExporter.js"></script>
  
  <style>
    body { margin: 0; overflow: hidden; background: radial-gradient(circle at center, #0b1a33 0%, #000000 100%); color: #fff; font-family: sans-serif; }
    
    #ui-container {
      position: absolute; top: 20px; left: 20px; z-index: 10;
      background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
      padding: 20px; border-radius: 15px; border-left: 4px solid #d4af37;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 350px;
    }
    
    h1 { margin: 0 0 10px 0; color: #d4af37; font-size: 1.4rem; letter-spacing: 1px; text-transform: uppercase; }
    p { font-size: 0.9rem; color: #ccc; line-height: 1.5; }
    
    button {
      background: linear-gradient(135deg, #d4af37 0%, #aa8800 100%);
      border: none; padding: 10px 20px; color: #000; font-weight: bold;
      border-radius: 25px; cursor: pointer; margin-top: 10px; width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover { transform: scale(1.02); box-shadow: 0 0 15px #d4af37; color: #fff; }

    /* Modal Styles */
    #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 20; justify-content: center; align-items: center; }
    #modal-box { background: #111; border: 2px solid #d4af37; padding: 40px; max-width: 500px; text-align: center; border-radius: 10px; position: relative; }
    .close-btn { position: absolute; top: 10px; right: 20px; font-size: 30px; color: #d4af37; cursor: pointer; }
  </style>
</head>
<body>

<div id="ui-container">
  <h1>7 Gaben Pyramide</h1>
  <p>Eine interaktive Visualisierung der Rosary Ridgebed Struktur.</p>
  <p style="font-size: 0.8rem; color: #d4af37;">âœ¨ Tippe auf die Ebenen fÃ¼r Psalmen</p>
  <button onclick="exportSTL()">ðŸ’¾ Modell downloaden (STL)</button>
  <button onclick="toggleRotation()">ðŸ”„ Rotation an/aus</button>
</div>

<div id="modal" onclick="closeModal()">
  <div id="modal-box" onclick="event.stopPropagation()">
    <span class="close-btn" onclick="closeModal()">Ã—</span>
    <h2 id="m-title" style="color: #d4af37; margin-top:0;"></h2>
    <hr style="border-color: #333; margin: 15px 0;">
    <p id="m-text" style="font-size: 1.1em; font-style: italic;"></p>
    <p id="m-law" style="color: #888; font-size: 0.9em; margin-top: 20px;"></p>
  </div>
</div>

<script>
// --- SZENE SETUP ---
const scene = new THREE.Scene();
// Kein statischer Hintergrund mehr, damit der CSS Gradient wirkt:
scene.background = null; 

const camera = new THREE.PerspectiveCamera(55, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(15, 12, 20);

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
// WICHTIG: Schatten aktivieren
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
// WICHTIG: Farben korrigieren fÃ¼r realistischeren Look
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.autoRotate = true;
controls.autoRotateSpeed = 1.0;

// --- GENERATOR FÃœR GRAS-TEXTUR (Keine externen Bilder!) ---
function createGrassTexture() {
  const canvas = document.createElement('canvas');
  canvas.width = 512; canvas.height = 512;
  const ctx = canvas.getContext('2d');
  // Grundfarbe
  ctx.fillStyle = '#2a5a1b';
  ctx.fillRect(0,0,512,512);
  // Rauschen/Gras-Struktur zeichnen
  for(let i=0; i<10000; i++) {
    ctx.fillStyle = Math.random() > 0.5 ? '#3a7a2b' : '#1a3a0b';
    const x = Math.random() * 512;
    const y = Math.random() * 512;
    const w = Math.random() * 4 + 1;
    const h = Math.random() * 10 + 2;
    ctx.fillRect(x,y,w,h);
  }
  const texture = new THREE.CanvasTexture(canvas);
  texture.wrapS = THREE.RepeatWrapping;
  texture.wrapT = THREE.RepeatWrapping;
  texture.repeat.set(4, 1);
  return texture;
}
const grassTexture = createGrassTexture();

// --- BELEUCHTUNG (Cinematic) ---
const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
scene.add(ambientLight);

const sunLight = new THREE.DirectionalLight(0xfffaed, 2.5);
sunLight.position.set(20, 50, 20);
sunLight.castShadow = true;
sunLight.shadow.mapSize.width = 2048;
sunLight.shadow.mapSize.height = 2048;
scene.add(sunLight);

// Goldenes Licht von unten fÃ¼r Dramatik
const spotLight = new THREE.SpotLight(0xd4af37, 10);
spotLight.position.set(0, -10, 0);
spotLight.angle = Math.PI / 4;
scene.add(spotLight);

// --- GEOMETRIE ---
const terraces = [];
const colors = [0x5c4033, 0x70503c, 0x2e8b57, 0x4a3728, 0x3e2b1f, 0x2b1e16, 0xffffff]; // Letzte Farbe ignoriert da Textur
const gaben = ["Furcht des Herrn", "FrÃ¶mmigkeit", "Erkenntnis", "StÃ¤rke", "Rat", "Verstand", "Weisheit (Spitze)"];

for(let i=0; i<7; i++) {
  const bottomR = 9 - i * 1.2;
  const topR = 9 - (i + 1) * 1.2;
  const height = 1.5;
  
  const geometry = new THREE.CylinderGeometry(topR, bottomR, height, 64);
  
  let material;
  
  // Oberste Schicht bekommt Gras-Textur
  if (i === 6) {
     material = new THREE.MeshStandardMaterial({ 
       map: grassTexture,
       bumpMap: grassTexture,
       bumpScale: 0.5,
       color: 0xffffff,
       roughness: 0.8
     });
  } else {
     // Andere Schichten: Erd-Look (StandardMaterial reagiert auf Licht)
     material = new THREE.MeshStandardMaterial({ 
       color: colors[i], 
       roughness: 0.9, // Matt wie Erde
       metalness: 0.1
     });
  }

  const mesh = new THREE.Mesh(geometry, material);
  mesh.position.y = -4 + (i * height);
  mesh.castShadow = true; // Wirft Schatten
  mesh.receiveShadow = true; // EmpfÃ¤ngt Schatten
  mesh.userData = { id: i };
  
  scene.add(mesh);
  terraces.push(mesh);
}

// --- GOLDENE SPIRALE (Leuchtend) ---
const points = [];
let r = 0.1, ang = 0, yPos = -4;
for(let i=0; i<1000; i++) {
  points.push(new THREE.Vector3(r * Math.cos(ang), yPos, r * Math.sin(ang)));
  ang += 0.15;
  r += 0.008;
  yPos += 0.015;
}
const tubeGeo = new THREE.TubeGeometry(new THREE.CatmullRomCurve3(points), 300, 0.1, 8, false);
const tubeMat = new THREE.MeshStandardMaterial({ 
  color: 0xffd700, 
  emissive: 0xffaa00, // Selbstleuchtend
  emissiveIntensity: 0.5,
  metalness: 1, 
  roughness: 0.2 
});
const spiral = new THREE.Mesh(tubeGeo, tubeMat);
spiral.castShadow = true;
scene.add(spiral);

// --- SPITZE (Reflektierendes Gold) ---
const topGeo = new THREE.OctahedronGeometry(1.5, 0);
const goldMat = new THREE.MeshPhysicalMaterial({
  color: 0xffd700,
  metalness: 1.0,
  roughness: 0.0, // Spiegelglatt
  clearcoat: 1.0,
  clearcoatRoughness: 0.1
});
const star = new THREE.Mesh(topGeo, goldMat);
star.position.set(0, 7.5, 0);
star.castShadow = true;
scene.add(star);

// --- LOGIK ---
const dataText = [
  {t:"Demut ist das Fundament.", l:"Gesetz: Das Fundament trÃ¤gt alles."},
  {t:"FrÃ¶mmigkeit verbindet uns.", l:"Gesetz: Verbindung schafft StÃ¤rke."},
  {t:"Erkenntnis Ã¶ffnet die Augen.", l:"Gesetz: Sehen heiÃŸt Verstehen."},
  {t:"StÃ¤rke gibt uns Halt.", l:"Gesetz: Widerstand formt Charakter."},
  {t:"Rat weist den Weg.", l:"Gesetz: Orientierung spart Energie."},
  {t:"Verstand durchdringt alles.", l:"Gesetz: Tiefe vor Breite."},
  {t:"Weisheit vollendet das Werk.", l:"Gesetz: Das Ende krÃ¶nt den Anfang."}
];

const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener('pointerdown', (event) => {
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(terraces);
  
  if(intersects.length > 0) {
    const id = intersects[0].object.userData.id;
    document.getElementById('m-title').innerText = (id+1) + ". " + gaben[id];
    document.getElementById('m-text').innerText = dataText[id].t;
    document.getElementById('m-law').innerText = dataText[id].l;
    document.getElementById('modal').style.display = 'flex';
    controls.autoRotate = false;
  }
});

function closeModal() {
  document.getElementById('modal').style.display = 'none';
  controls.autoRotate = true;
}

function toggleRotation() {
  controls.autoRotate = !controls.autoRotate;
}

function exportSTL() {
  const exporter = new THREE.STLExporter();
  const str = exporter.parse(scene);
  const blob = new Blob([str], {type: 'text/plain'});
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'Rosary_Pyramid.stl';
  link.click();
}

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  // Leichte Animation der Spitze
  star.rotation.y += 0.01;
  star.position.y = 7.5 + Math.sin(Date.now() * 0.002) * 0.2;
  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
